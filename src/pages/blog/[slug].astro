---
import { getCollection, getEntryBySlug } from 'astro:content';
import BlogLayout from '../../components/BlogLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(p => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const post = await getEntryBySlug('blog', slug);
if (!post) throw new Error('Post not found');

const { Content } = await post.render();

---
<BlogLayout>
  <div class="container my-4">
    <div class="row">
      <div class="col-lg-8 offset-lg-2">
        <nav aria-label="Breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/blog">Blog</a></li>
            <li class="breadcrumb-item active" aria-current="page">{post.data.title}</li>
          </ol>
        </nav>
        <h1>{post.data.title}</h1>
        {post.data.pubDate && (
          <p class="text-muted">{post.data.pubDate.toLocaleDateString()}</p>
        )}
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 offset-lg-2">
        <Content />
        {post.data.tags?.length ? (
          <p>
            {post.data.tags.map(t => (
              <a href={`/blog/tags/${t}`} class="badge bg-secondary me-1" key={t}>{t}</a>
            ))}
          </p>
        ) : null}
      </div>
    </div>
  </div>
</BlogLayout>
