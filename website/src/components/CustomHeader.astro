---
// Bootstrap navbar for site navigation
const { isDocs = false } = Astro.props;
const isDashboard = Astro.url.pathname.startsWith('/dashboard');
const mainNav = [
  { label: 'Dashboard', link: '/dashboard', isDash: true },
  { label: 'Home', link: '/' },
  { label: 'Pricing', link: '/pricing' },
  { label: 'Leads', link: '/leads' },
  { label: 'Free Tools', link: '/testing' },
  { label: 'Blog', link: '/blog' },
  { label: 'Contact', link: '/contact' },
  { label: 'Docs & Guides', link: '/introduction/how-blue-frog-analytics-works' },
];
const currentPath =
  Astro.url.pathname === '/'
    ? '/'
    : Astro.url.pathname.replace(/\/$/, '').toLowerCase();
function isActive(item) {
  const link = item.link === '/' ? '/' : item.link.replace(/\/$/, '').toLowerCase();

  if (item.label === 'Docs & Guides') return isDocs;
  if (item.label === 'Free Tools') {
    return currentPath.startsWith('/testing') || currentPath.startsWith('/tests');
  }
  if (item.label === 'Blog') return currentPath.startsWith('/blog');
  if (link === '/') return currentPath === '/';
  return currentPath === link || currentPath.startsWith(link + '/');
}
---
<!-- Skip link for accessibility -->
<a href="#main-content" class="visually-hidden-focusable">Skip to main content</a>
<nav
  id="site-navbar"
  class="navbar navbar-expand-lg fixed-top navbar-light bg-light navbar-charcoal"
  aria-label="Main navigation"
>
  <div class="container-fluid">
    <a class="navbar-brand site-logo d-flex align-items-center" href="/">
      <span class="text-primary">BlueFrog</span><span class="fw-bold">Analytics</span>
    </a>
    <span class="mx-2 d-none d-lg-inline text-body-secondary opacity-75">|</span>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav mb-2 mb-lg-0 me-auto">
        {mainNav.map(item => (
          <li class={`nav-item${item.isDash ? ' d-none' : ''}`} key={item.link} id={item.isDash ? 'dashboard-nav' : undefined}>
            <a class={`nav-link${isActive(item) ? ' active' : ''}`} href={item.link}>{item.label}</a>
          </li>
        ))}
      </ul>
      <a id="login-btn" class="btn btn-outline-primary ms-lg-2" href="/login">
        Client Login
      </a>
      <div id="profile-menu" class="dropdown ms-lg-2 d-none">
        <a
          class="btn dropdown-toggle btn-outline-primary"
          href="#"
          role="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Profile
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="/dashboard/profile">Profile</a></li>
          <li><a class="dropdown-item" href="/dashboard/settings">Settings</a></li>
          <li><a class="dropdown-item" href="/dashboard/billing">Billing</a></li>
          <li><hr class="dropdown-divider" /></li>
          <li><a id="logout-link" class="dropdown-item" href="#">Logout</a></li>
        </ul>
      </div>
      <button id="theme-toggle" class="btn btn-outline-secondary ms-lg-2" aria-label="Toggle dark mode">
        <i id="theme-icon" class="bi bi-moon-fill"></i>
      </button>
    </div>
  </div>
</nav>
<script is:inline>
  const saved = localStorage.getItem('bfaLoggedIn');
  if (saved !== null) {
    const loggedIn = saved === 'true';
    const loginBtn = document.getElementById('login-btn');
    const profileMenu = document.getElementById('profile-menu');
    const dashNav = document.getElementById('dashboard-nav');
    if (loginBtn && profileMenu) {
      if (loggedIn) {
        loginBtn.classList.add('d-none');
        profileMenu.classList.remove('d-none');
      } else {
        loginBtn.classList.remove('d-none');
        profileMenu.classList.add('d-none');
      }
    }
    if (dashNav) {
      dashNav.classList.toggle('d-none', !loggedIn);
    }
  }

  const themeBtn = document.getElementById('theme-toggle');
  const themeIcon = document.getElementById('theme-icon');
  if (themeBtn && themeIcon) {
    const savedDark = localStorage.getItem('bfaDarkMode') === 'true';
    function setTheme(dark) {
      document.documentElement.classList.toggle('dark-mode', dark);
      document.body.classList.toggle('dark-mode', dark);
      const nav = document.getElementById('site-navbar');
      if (nav) {
        nav.classList.toggle('navbar-dark', dark);
        nav.classList.toggle('bg-dark', dark);
        nav.classList.toggle('navbar-light', !dark);
        nav.classList.toggle('bg-light', !dark);
        nav.classList.toggle('navbar-charcoal', !dark);
      }
      const loginBtn = document.getElementById('login-btn');
      if (loginBtn) {
        loginBtn.classList.toggle('btn-outline-light', dark);
        loginBtn.classList.toggle('btn-outline-primary', !dark);
      }
      const profileToggle = document.querySelector('#profile-menu > a');
      if (profileToggle) {
        profileToggle.classList.toggle('btn-outline-light', dark);
        profileToggle.classList.toggle('btn-outline-primary', !dark);
      }
      document.querySelectorAll('table.table').forEach(t => {
        t.classList.toggle('table-dark', dark);
      });
      const footer = document.getElementById('site-footer');
      if (footer) {
        footer.classList.toggle('bg-dark', dark);
        footer.classList.toggle('text-light', dark);
        footer.classList.toggle('bg-light', !dark);
        footer.classList.toggle('text-dark', !dark);
      }
      themeIcon.classList.toggle('bi-sun-fill', dark);
      themeIcon.classList.toggle('bi-moon-fill', !dark);
      localStorage.setItem('bfaDarkMode', dark);
    }
    setTheme(savedDark);
    themeBtn.addEventListener('click', () =>
      setTheme(!document.documentElement.classList.contains('dark-mode'))
    );
  }
</script>
