---
// Bootstrap navbar for site navigation
const { isDocs = false } = Astro.props;
const isDashboard = Astro.url.pathname.startsWith('/dashboard');
const mainNav = [
  { label: 'Dashboard', link: '/dashboard', isDash: true },
  { label: 'Home', link: '/' },
  { label: 'Pricing', link: '/pricing' },
  { label: 'Free Tools', link: '/testing' },
  { label: 'Blog', link: '/blog' },
  { label: 'Contact', link: '/contact' },
  { label: 'Docs & Guides', link: '/introduction/how-blue-frog-analytics-works' },
];
const currentPath =
  Astro.url.pathname === '/'
    ? '/'
    : Astro.url.pathname.replace(/\/$/, '').toLowerCase();
function isActive(item) {
  const link = item.link === '/' ? '/' : item.link.replace(/\/$/, '').toLowerCase();

  if (item.label === 'Docs & Guides') return isDocs;
  if (item.label === 'Free Tools') {
    return currentPath.startsWith('/testing') || currentPath.startsWith('/tests');
  }
  if (item.label === 'Blog') return currentPath.startsWith('/blog');
  if (link === '/') return currentPath === '/';
  return currentPath === link || currentPath.startsWith(link + '/');
}
---
<!-- Skip link for accessibility -->
<a href="#main-content" class="visually-hidden-focusable">Skip to main content</a>
<nav class={
  `navbar navbar-expand-lg fixed-top ${
    isDashboard ? 'navbar-dark bg-dark' : 'navbar-light bg-light navbar-charcoal'
  }`
} aria-label="Main navigation">
  <div class="container-fluid">
    <a class="navbar-brand site-logo d-flex align-items-center" href="/">
      <span class="text-primary">BlueFrog</span><span class="fw-bold">Analytics</span>
    </a>
    <span class="mx-2 d-none d-lg-inline text-body-secondary opacity-75">|</span>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav mb-2 mb-lg-0 me-auto">
        {mainNav.map(item => (
          <li class={`nav-item${item.isDash ? ' d-none' : ''}`} key={item.link} id={item.isDash ? 'dashboard-nav' : undefined}>
            <a class={`nav-link${isActive(item) ? ' active' : ''}`} href={item.link}>{item.label}</a>
          </li>
        ))}
      </ul>
      <a
        id="login-btn"
        class={`btn ${isDashboard ? 'btn-outline-light' : 'btn-outline-primary'} ms-lg-2`}
        href="/login"
      >
        Client Login
      </a>
      <div id="profile-menu" class="dropdown ms-lg-2 d-none">
        <a
          class={`btn dropdown-toggle ${isDashboard ? 'btn-outline-light' : 'btn-outline-primary'}`}
          href="#"
          role="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Profile
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="/dashboard/profile">Profile</a></li>
          <li><a class="dropdown-item" href="/dashboard/settings">Settings</a></li>
          <li><a class="dropdown-item" href="/dashboard/billing">Billing</a></li>
          <li><hr class="dropdown-divider" /></li>
          <li><a id="logout-link" class="dropdown-item" href="#">Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>
<script is:inline>
  const saved = localStorage.getItem('bfaLoggedIn');
  if (saved !== null) {
    const loggedIn = saved === 'true';
    const loginBtn = document.getElementById('login-btn');
    const profileMenu = document.getElementById('profile-menu');
    const dashNav = document.getElementById('dashboard-nav');
    if (loginBtn && profileMenu) {
      if (loggedIn) {
        loginBtn.classList.add('d-none');
        profileMenu.classList.remove('d-none');
      } else {
        loginBtn.classList.remove('d-none');
        profileMenu.classList.add('d-none');
      }
    }
    if (dashNav) {
      dashNav.classList.toggle('d-none', !loggedIn);
    }
  }
</script>
