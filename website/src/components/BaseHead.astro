---
import '../styles/global.scss';
import favicon16 from '../assets/favicon-16x16.png';
import favicon32 from '../assets/favicon-32x32.png';

const { title = 'Blue Frog Analytics', description = '', url } = Astro.props;
const apiOrigin = new URL(
  import.meta.env.PUBLIC_API_BASE_URL ||
    'https://api.bluefroganalytics.com:6001'
).origin;
const csp =
  "default-src 'self'; " +
  "script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.gstatic.com https://cdn.jsdelivr.net https://apis.google.com https://www.google-analytics.com; " +
  "style-src 'self' https://cdn.jsdelivr.net https://fonts.googleapis.com 'unsafe-inline'; " +
  "img-src 'self' data:; " +
  "font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net; " +
  "connect-src 'self' https://analytics.google.com https://www.google-analytics.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com " +
  apiOrigin +
  '; frame-src 'self' https://bluefroganalytics.firebaseapp.com https://accounts.google.com;';
---
<!-- BaseHead: injects global head tags (Bootstrap CSS, fonts, scripts) -->
<script is:inline>
  try {
    const darkPref = localStorage.getItem('bfaDarkMode') === 'true';
    const onDashboard = window.location.pathname.startsWith('/dashboard');
    if (darkPref && onDashboard) {
      document.documentElement.classList.add('dark-mode');
      document.addEventListener('DOMContentLoaded', () => {
        document.body.classList.add('dark-mode');
      });
    }
  } catch (e) {}
</script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta
  http-equiv="Content-Security-Policy"
  content={csp}
/>
<title>{title}</title>
{description && <meta name="description" content={description} />}
<link rel="canonical" href={url ?? Astro.url.href} />
<meta property="og:title" content={title} />
{description && <meta property="og:description" content={description} />}

<meta name="robots" content="index,follow" />

<meta property="og:type" content="website" />
<meta property="og:url" content={url ?? Astro.url.href} />

<!-- Bootstrap CSS -->
<link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" onload="this.onload=null;this.rel='stylesheet'" crossorigin="anonymous" />
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" /></noscript>
<!-- Bootstrap Icons -->
<link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" onload="this.onload=null;this.rel='stylesheet'" crossorigin="anonymous" />
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" /></noscript>
<!-- IBM Plex Sans font -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preconnect" href="https://www.gstatic.com" crossorigin />
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;600&display=swap" onload="this.onload=null;this.rel='stylesheet'" crossorigin="anonymous" />
<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;600&display=swap" /></noscript>

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" type="image/png" sizes="32x32" href={favicon32.src} />
<link rel="icon" type="image/png" sizes="16x16" href={favicon16.src} />

<!-- Bootstrap JS -->
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Google Analytics (load after page) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4N0P7Z1VJ8" crossorigin="anonymous"></script>
<script>
  window.addEventListener('load', () => {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4N0P7Z1VJ8');
  });
</script>
